<div class="container">
    <div class="d-flex">
        <h4 class="mr-auto p-2">Mensajes</h4>
        <div class="p-2">
            <button class="btn btn-primary btn-sm btn-write-message p-2" (click)="newMessage()"><i class="fas fa-pencil-alt icon-with-text"></i>Nuevo mensaje</button>
        </div>
    </div>

    <hr>
    
    <div class="row messages-div">
        <div class="col col-sm-3 messages-menu">
            <div class="list-group" id="list-tab" role="tablist">
                <a class="list-group-item list-group-item-action active d-flex justify-content-between align-items-center btn-messages"
                    id="messages" data-toggle="list" href="#messages-list" role="tab" aria-controls="messages">
                    <strong>Mensajes</strong>
                    <span class="badge badge-light">{{_unreadMessagesCount}}</span>
                </a>
                <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center btn-friend-request"
                    id="friend-request" data-toggle="list" href="#friend-request-list" role="tab" aria-controls="friend-request">
                    <strong>Peticiones de amistad</strong>
                    <span class="badge badge-light">{{_requestsCount}}</span>
                </a>
            </div>
        </div>

        <div class="col col-sm-9 messages-list">
            <div class="tab-content" *ngIf="!_messagesService.showMessage.getValue()">
                <div class="tab-pane fade show active" id="messages-list" role="tabpanel" aria-labelledby="messages">
                    <ul class="list-group" *ngIf="_messages.length > 0">
                        <li class="list-group-item d-flex justify-content-start align-items-center middle-messages" *ngFor="let message of _messages; let i = index;" [ngClass]="{'unread-message': message?.status == 'Unread', 'first-message': i == 0, 'middle-messages': i != 0 && i != _messages.length - 1, 'last-message': i == _messages.length - 1}">
                            <img class="message-profile-picture" src="{{_imagesUrl}}/{{message.userTransmitter?.profilePicture}}" width="38" height="38">
                            <div (click)="showMessage(message)"><span class="message-title">{{message.userTransmitter?.name}} {{message.userTransmitter?.surname}}: {{message.title}}</span></div>
                        </li>
                    </ul>
                </div>
                <div class="tab-pane fade" id="friend-request-list" role="tabpanel" aria-labelledby="friend-request">
                    <ul class="list-group" *ngIf="_friendRequests.length > 0">
                        <li class="list-group-item d-flex justify-content-between align-items-center middle-messages unread-message" *ngFor="let friendRequest of _friendRequests; let i = index;" [ngClass]="{'first-message': i == 0, 'middle-messages': i != 0 && i != _messages.length - 1, 'last-message': i == _messages.length - 1}">
                            <div>
                                <img class="message-profile-picture" src="{{_imagesUrl}}/{{friendRequest.user1?.profilePicture}}" width="38" height="38">
                                <span class="message-title" (click)="showPofile(friendRequest.user1?.id)">{{friendRequest.user1?.name}} {{friendRequest.user1?.surname}}</span>
                            </div>
                            <div [ngStyle]="{'margin-right': '3px'}">
                                <button class="btn btn-danger btn-sm" (click)="rejectFriendRequest(friendRequest.id)"><i class="fas fa-times icon-with-text"></i> Rechazar</button>
                                <button class="btn btn-success btn-sm" [ngStyle]="{'margin-left': '5px'}" (click)="acceptFriendRequest(friendRequest)"><i class="fas fa-check icon-with-text"></i> Aceptar</button>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="tab-content" *ngIf="_messagesService.showMessage.getValue()">
                <message [_message]="_messageToShow"></message>
            </div>
        </div>
    </div>
</div>
